<style>
  body {
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 0;
  }

  #toggle-button {
    position: fixed;
    bottom: 20px;
    left: 20px;
    width: 55px;
    height: 55px;
    border-radius: 50%;
    background: linear-gradient(135deg, #000, #444);
    color: white;
    font-size: 20px;
    border: none;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.25);
    z-index: 1001;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #toggle-button:hover {
    background: linear-gradient(135deg, #111, #555);
  }

  .chat-container {
    position: fixed;
    bottom: 80px;
    left: 20px;
    width: 360px;
    height: 480px;
    background: #fff;
    border-radius: 20px;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
    display: flex;
    flex-direction: column;
    z-index: 1000;
    display: none;
  }

  .chat-header {
    background: linear-gradient(135deg, #000, #444);
    color: white;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 15px;
  }

  .chat-header span {
    font-size: 16px;
    font-weight: 600;
  }

  .close-button {
    background: transparent;
    border: none;
    color: white;
    font-size: 18px;
    cursor: pointer;
  }

  .chat-box {
    flex: 1;
    overflow-y: auto;
    padding: 15px;
    background: #f4f4f9;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .chat-message {
    display: flex;
    align-items: flex-end;
    margin: 5px 0;
    max-width: 80%;
    flex-wrap: wrap;
  }

  .chat-message.bot .avatar {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    margin-right: 6px;
    flex-shrink: 0;
  }

  .chat-bubble {
    padding: 8px 12px;
    border-radius: 15px;
    font-size: 14px;
    line-height: 1.4;
    word-wrap: break-word;
    max-width: 100%;
  }

  .chat-message.bot .chat-bubble {
    background: #e6e6e6;
    color: #333;
  }

  .chat-message.user {
    justify-content: flex-end;
  }

  .chat-message.user .chat-bubble {
    background: linear-gradient(135deg, #000, #444);
    color: white;
  }

  .input-container {
    display: flex;
    padding: 8px;
    background: #fff;
    border-top: 1px solid #ddd;
  }

  input[type="text"] {
    flex: 1;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 25px;
    font-size: 14px;
    outline: none;
  }

  input[type="text"]:focus {
    border-color: #000;
  }

  #send-button {
    margin-left: 6px;
    border: none;
    background: linear-gradient(135deg, #000, #444);
    color: white;
    padding: 0 15px;
    border-radius: 25px;
    cursor: pointer;
  }

  #send-button:disabled {
    background: #bbb;
    cursor: not-allowed;
  }

  .chat-box::-webkit-scrollbar {
    width: 6px;
  }

  .chat-box::-webkit-scrollbar-thumb {
    background: #aaa;
    border-radius: 10px;
  }

  .followup-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 5px;
  }

  .followup-buttons a {
    background: #000;
    color: #fff;
    padding: 6px 10px;
    border-radius: 12px;
    text-decoration: none;
    font-size: 13px;
    cursor: pointer;
  }

  .followup-buttons a:hover {
    background: #444;
  }

  /* -------- MOBILE FIXES -------- */
  @media (max-width: 600px) {
    .chat-container {
      bottom: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      border-radius: 0;
    }

    #toggle-button {
      bottom: 15px;
      left: 15px;
      width: 50px;
      height: 50px;
      font-size: 20px;
    }

    .chat-header span {
      font-size: 14px;
    }

    .chat-bubble {
      font-size: 13px;
      padding: 7px 10px;
    }

    input[type="text"] {
      font-size: 13px;
    }

    #send-button {
      font-size: 13px;
      padding: 0 12px;
    }
  }
</style>

<button id="toggle-button" onclick="toggleChat()">Chat</button>

<div class="chat-container" id="chat-container">
  <div class="chat-header">
    <span>Ας συνομιλήσουμε!</span>
    <button class="close-button" onclick="toggleChat()">✖</button>
  </div>
  <div class="chat-box" id="chat-box"></div>
  <div class="input-container">
    <input type="text" id="user-input" placeholder="Type your message..." onkeyup="checkInput()" />
    <button id="send-button" onclick="sendMessage()" disabled>Send</button>
  </div>
</div>

<script>
  const userInputElement = document.getElementById('user-input');
  const chatBox = document.getElementById('chat-box');
  const sendButton = document.getElementById('send-button');
  const chatContainer = document.getElementById('chat-container');
  const toggleButton = document.getElementById('toggle-button');

  userInputElement.addEventListener('keyup', (event) => {
    if (event.key === 'Enter' && userInputElement.value.trim()) sendMessage();
    else checkInput();
  });

  function checkInput() {
    sendButton.disabled = !userInputElement.value.trim();
  }

  function sendMessage(message = null) {
    const userInput = message || userInputElement.value.trim();
    if (!userInput) return;

    appendMessage(userInput, 'user');

    fetch("https://chatbotmaxilariagr.com/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: userInput })
    })
      .then(response => response.json())
      .then(data => {
        displayBotMessage(data.response);
      });

    userInputElement.value = '';
    sendButton.disabled = true;
  }

  function toggleChat() {
    if (chatContainer.style.display === "none" || chatContainer.style.display === "") {
      chatContainer.style.display = "flex";
      toggleButton.style.display = "none";
    } else {
      chatContainer.style.display = "none";
      toggleButton.style.display = "flex";
    }
  }

  function makeUrlsClickable(text) {
    const urlRegex = /(https?:\/\/[^\s]+)/g;
    return text.replace(urlRegex, url => `<a href="${url}" target="_blank" rel="noopener noreferrer">${url}</a>`);
  }

  function appendMessage(message, sender) {
    const msg = document.createElement('div');
    msg.classList.add('chat-message', sender);

    if (sender === 'bot') {
      const avatar = document.createElement('img');
      avatar.src = "https://maxilaria.gr/wp-content/uploads/2022/02/Maxilariaico.png";
      avatar.classList.add('avatar');
      msg.appendChild(avatar);
    }

    const bubble = document.createElement('div');
    bubble.classList.add('chat-bubble');
    bubble.innerHTML = message;

    msg.appendChild(bubble);
    chatBox.appendChild(msg);
    chatBox.scrollTop = chatBox.scrollHeight;
    return msg;
  }

  function displayBotMessage(message) {
    const followupPattern = /Τι εννοείτε; Επιλέξτε μία από τις εξής επιλογές:/;
    const msg = appendMessage(makeUrlsClickable(message), 'bot');

    if (followupPattern.test(message)) {
      const choices = message.split(':')[1].split(',').map(c => c.trim());
      const buttonsContainer = document.createElement('div');
      buttonsContainer.classList.add('followup-buttons');
      choices.forEach(choice => {
        const a = document.createElement('a');
        a.textContent = choice;
        a.onclick = () => sendMessage(choice);
        buttonsContainer.appendChild(a);
      });
      msg.appendChild(buttonsContainer);
    }
  }

  window.onload = function () {
    appendMessage("Γεια σας! Πώς μπορώ να σας βοηθήσω;", 'bot');
  }
</script>
